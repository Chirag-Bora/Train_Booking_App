<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Search - Blue & Yellow Theme</title>
    <link rel="stylesheet" href="css/serach_train.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-train"></i>
                <span>RailSearch</span>
            </div>
        </div>
    </header>

    
    <form action="" id="searchForm"></form>
      <div class="container">
          <div class="search-container">
              <h2 class="search-title">Search for Trains</h2>
              <form class="search-form">
                  <div class="form-group">
                      <label for="from">From</label>
                      <input type="text" id="from" placeholder="Jodhpur Jn (JU)" value="Jodhpur Jn (JU)">
                  </div>
                  <div class="form-group">
                      <label for="to">To</label>
                      <input type="text" id="to" placeholder="Jaipur Jn (JP)" value="Jaipur Jn (JP)">
                  </div>
                  <div class="form-group">
                      <label for="date">Date</label>
                      <input type="date" id="date" value="2023-10-15">
                  </div>
                  <button type="submit" class="btn-search">Search Trains</button>
              </form>
          </div>
      </div>    
    </form>
   <script>
document.getElementById("searchForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const from = document.getElementById("from").value;
  const to = document.getElementById("to").value;
  const date = document.getElementById("date").value;


  document.getElementById("results").innerHTML = "<p>Loading trains...</p>";

  try {
    const response = await fetch("http://localhost:5000/api/search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ from, to, date, travelClass: "all" }) // sending default class = all
    });

    const trains = await response.json();

    if (!Array.isArray(trains) || trains.length === 0) {
      document.getElementById("results").innerHTML = "<p>No trains found for this route.</p>";
      return;
    }

    let output = `
      <div class="results-header">
        <h2 class="results-title">Available Trains (${trains.length})</h2>
      </div>
    `;

    trains.forEach(train => {
      output += `
        <div class="train-card">
          <div class="train-header">
            <div class="train-name">${train.train_name} (${train.train_number})</div>
            <div class="train-badges">
              <span class="badge">Available</span>
            </div>
          </div>
          <div class="train-details">
            <div class="class-availability">
              <table class="class-table">
                <thead>
                  <tr>
                    <th>Class</th>
                    <th>Availability</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>${train.coach_type}</td>
                    <td class="available">Available (${train.available_seats})</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    });

    document.getElementById("results").innerHTML = output;

  } catch (err) {
    document.getElementById("results").innerHTML = "<p>Error fetching data.</p>";
    console.error(err);
  }
});
</script>

</body>
</html>